{% extends 'base.html.twig' %}

{% block title %}Board - {{ app.user.firstname }}{% endblock %}

{% block body %}
    <main class="consultantBoard">
        <header class="mt-3 mb-3 ms-5">
            <h1>Bonjour {{ app.user.firstname }} !</h1>
        </header>
        <div class="d-flex flex-wrap gap-4 justify-content-center">

            <section class="rdvList col-5">
                <h2>Vos RDVs</h2>
                <table class="table table-striped table-sm">
                    <thead class="thead-light">
                    <tr>
                        <th scope="row">Cette semaine :</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for appointment in weekAppointment %}
                        <tr>
                            <td>{{ appointment.date|format_datetime('full', 'short', locale='fr') }}</td>
                            <td>With</td>
                            <td>{{ appointment.recruitmentProcess.candidat.user.firstname|upper }} {{ appointment.recruitmentProcess.candidat.user.lastName|capitalize }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                    <thead>
                    <tr>
                        <th>Ce mois :</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for appointment in otherAppointment %}
                        <tr>
                            <td>{{ appointment.date|format_datetime('full', 'short', locale='fr') }}</td>
                            <td>With</td>
                            <td>{{ appointment.recruitmentProcess.candidat.user.lastName|upper }} {{ appointment.recruitmentProcess.candidat.user.firstname|capitalize }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </section>

            <section class="messages col-5">
                <h2><a href="{{ path('message_index') }}">Votre messagerie({{ app.user.consultant.annonces.count }})</a></h2>
                <table class="table table-striped table-sm">
                    <thead class="thead-light">
                    <tr>
                        <th scope="row">Date</th>
                        <th scope="row">Expediteur</th>
                        <th scope="row">Contenu</th>
                    </tr>
                    </thead>
                    <tbody data-controller="inbox">
                    {% for message in messages %}
                        <tr class="messageHeader" data-messageid="{{ message.recruitmentProcess.id }}">
                            <td class="col-2">{{ message.date|format_datetime('short', 'short', locale='fr') }}</td>
                            <td class="col-2">{{ message.sendBy.lastName|upper }} {{ message.sendBy.firstname|capitalize }}</td>
                            <td class="messageContent">{{ message.content|raw }}</td>
                        </tr>
                        {% if loop.index == 10 %}
                            <tr>
                                <td class="text-center" colspan="3"><a href="{{ path('message_index') }}"><strong>...</strong></a></td>
                            </tr>
                        {% endif %}
                    {% endfor %}
                    </tbody>
                </table>
            </section>

            <section class="recruitProssList col-10">
                <h2><a href="{{ path('consultant_annonces') }}">Vos annonces en cours ({{ app.user.consultant.annonces.count }})</a></h2>
                <table class="table table-striped table-sm">
                    <thead>
                    <tr>
                        <th scope="row">Company</th>
                        <th scope="row">Intitul√© <small>- date</small></th>
                        <th scope="row">Processus en cours</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for annonce in app.user.consultant.annonces %}
                        <tr>
                            <td><img src="{{ annonce.picture }}" alt="logo of an enterprise"/> {{ annonce.company.name }}</td>
                            <td><a href="{{ path('annonce_show', {"id": annonce.id}) }}"><strong>{{ annonce.title }}</strong><small>
                                    - {{ annonce.createdAt|date("d-m-y") }}</small></a></td>
                            <td>{{ annonce.recrutementProcesses|length }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </section>

        </div>
    </main>
{% endblock %}
